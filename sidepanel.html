<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My DevOps Timesheet</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <!-- Header -->
  <header id="header">
    <h1>My DevOps Timesheet</h1>
    <div class="header-actions">
      <button id="btn-darkmode" class="icon-btn" title="Toggle dark mode">&#x263d;</button>
      <button id="btn-refresh" class="icon-btn" title="Refresh (R)">&#x21bb;</button>
      <button id="btn-settings" class="icon-btn" title="Settings">&#x2699;</button>
    </div>
  </header>

  <!-- Settings View (Wizard) -->
  <section id="settings-view" class="view" hidden>
    <!-- Project Management Section -->
    <div id="project-management" class="project-mgmt">
      <h2 class="project-mgmt-title">Manage Projects</h2>
      <div id="project-list" class="project-list"></div>
      <button id="btn-add-project" class="btn-primary">Add New Project</button>
    </div>

    <div id="wizard" hidden>
      <div class="wizard-progress">
        <div class="wizard-progress-bar" id="wizard-bar"></div>
      </div>

      <!-- Step 1: Welcome -->
      <div class="wizard-step" data-step="0">
        <div class="wizard-icon">&#x1F680;</div>
        <h2 class="wizard-title">Welcome!</h2>
        <p class="wizard-desc">Let's connect to your Azure DevOps project. You'll need your organization name, project name, and a Personal Access Token.</p>
        <p class="wizard-desc wizard-desc-sub">This only takes a minute.</p>
        <div class="wizard-actions">
          <button class="btn-primary wizard-next">Get Started</button>
        </div>
        <div class="wizard-divider"><span>or</span></div>
        <div class="wizard-field wizard-url-field">
          <label for="input-url">Paste your Azure DevOps URL</label>
          <input type="url" id="input-url" placeholder="https://dev.azure.com/org/project">
          <p class="wizard-url-hint" id="url-hint" hidden></p>
        </div>
      </div>

      <!-- Step 2: Organization -->
      <div class="wizard-step" data-step="1" hidden>
        <div class="wizard-icon">&#x1F3E2;</div>
        <h2 class="wizard-title">Organization</h2>
        <p class="wizard-desc">Enter your Azure DevOps organization name. This is the part after <strong>dev.azure.com/</strong> in your URL.</p>
        <div class="wizard-field">
          <label for="input-org">Organization</label>
          <div class="wizard-input-hint">dev.azure.com/<strong>your-org</strong></div>
          <input type="text" id="input-org" placeholder="my-org" required>
        </div>
        <div class="wizard-actions">
          <button class="btn-secondary wizard-back">Back</button>
          <button class="btn-primary wizard-next">Next</button>
        </div>
      </div>

      <!-- Step 3: Project -->
      <div class="wizard-step" data-step="2" hidden>
        <div class="wizard-icon">&#x1F4CB;</div>
        <h2 class="wizard-title">Project</h2>
        <p class="wizard-desc">Enter the name of the Azure DevOps project you want to track work items from.</p>
        <div class="wizard-field">
          <label for="input-project">Project</label>
          <input type="text" id="input-project" placeholder="my-project" required>
        </div>
        <div class="wizard-actions">
          <button class="btn-secondary wizard-back">Back</button>
          <button class="btn-primary wizard-next">Next</button>
        </div>
      </div>

      <!-- Step 4: PAT -->
      <div class="wizard-step" data-step="3" hidden>
        <div class="wizard-icon">&#x1F511;</div>
        <h2 class="wizard-title">Access Token</h2>
        <p class="wizard-desc">Create a Personal Access Token (PAT) with <strong>Work Items &rarr; Read &amp; Write</strong> scope.</p>
        <p class="wizard-pat-link" id="pat-link-container" hidden>
          <a id="pat-link" href="#" target="_blank" rel="noopener">&#x1F517; Open Token Settings for your organization</a>
        </p>
        <details class="wizard-help">
          <summary>How do I create a PAT?</summary>
          <ol>
            <li>Go to <strong>dev.azure.com/{org}/_usersettings/tokens</strong></li>
            <li>Click <strong>New Token</strong></li>
            <li>Set a name and expiration date</li>
            <li>Under Scopes, select <strong>Work Items &rarr; Read &amp; Write</strong></li>
            <li>Click <strong>Create</strong> and copy the token</li>
          </ol>
        </details>
        <div class="wizard-field">
          <label for="input-pat">Personal Access Token</label>
          <input type="password" id="input-pat" placeholder="Paste your PAT here" required>
        </div>
        <div class="wizard-actions">
          <button class="btn-secondary wizard-back">Back</button>
          <button class="btn-primary wizard-next">Save &amp; Connect</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Work Items View -->
  <section id="workitems-view" class="view" hidden>
    <div class="toolbar">
      <div class="toolbar-search">
        <input type="text" id="search-input" placeholder="Search by ID or title..." autocomplete="off">
        <button id="btn-filter-toggle" class="toolbar-icon-btn" title="Toggle filters (F)">&#x1F50D;</button>
        <button id="btn-expand-all" class="toolbar-icon-btn" title="Expand all (E)">&#x25BC;</button>
      </div>
      <div id="filter-panel" class="filter-panel" hidden>
        <select id="project-filter">
          <option value="all">All Projects</option>
        </select>
        <select id="type-filter">
          <option value="">All Types</option>
        </select>
        <select id="iteration-filter">
          <option value="">All Iterations</option>
        </select>
      </div>
      <span id="summary"></span>
    </div>
    <div class="card-list" id="workitems-body"></div>
  </section>

  <!-- Error View -->
  <section id="error-view" class="view" hidden>
    <div class="error-content">
      <p id="error-message"></p>
      <button id="btn-retry" class="btn-primary">Retry</button>
    </div>
  </section>

  <!-- Status Bar -->
  <footer id="status-bar"></footer>

  <!-- Loading Overlay -->
  <div id="loading-overlay" hidden>
    <div class="spinner"></div>
    <span>Loading work items&hellip;</span>
  </div>

  <!-- Walkthrough Modal -->
  <div id="walkthrough-overlay" hidden>
    <div class="walkthrough-modal">
      <button id="walkthrough-close" class="walkthrough-close-btn" title="Close">&times;</button>
      <h2 class="walkthrough-title">&#x1F389; You're all set!</h2>
      <p class="walkthrough-intro">Here's a quick guide to help you get the most out of your timesheet.</p>
      
      <div class="walkthrough-features">
        <div class="walkthrough-feature">
          <span class="walkthrough-feature-icon">&#x1F50D;</span>
          <div class="walkthrough-feature-content">
            <strong>Search &amp; Filter</strong>
            <p>Use the search bar to find work items by ID or title. Click the magnifying glass or press <kbd>F</kbd> to toggle type and iteration filters.</p>
          </div>
        </div>
        
        <div class="walkthrough-feature">
          <span class="walkthrough-feature-icon">&#x25BC;</span>
          <div class="walkthrough-feature-content">
            <strong>Expand Details</strong>
            <p>Click the arrow on any work item to see more details like state, priority, and description. Press <kbd>E</kbd> to expand/collapse all.</p>
          </div>
        </div>
        
        <div class="walkthrough-feature">
          <span class="walkthrough-feature-icon">&#x270F;&#xFE0F;</span>
          <div class="walkthrough-feature-content">
            <strong>Inline Editing</strong>
            <p>Click on Remaining or Completed hours to edit them directly. Use arrow keys to navigate between fields.</p>
          </div>
        </div>
        
        <div class="walkthrough-feature">
          <span class="walkthrough-feature-icon">&#x263d;</span>
          <div class="walkthrough-feature-content">
            <strong>Light &amp; Dark Mode</strong>
            <p>Toggle between light and dark themes using the moon/sun icon in the header. Your preference is saved automatically.</p>
          </div>
        </div>
        
        <div class="walkthrough-feature">
          <span class="walkthrough-feature-icon">&#x21bb;</span>
          <div class="walkthrough-feature-content">
            <strong>Keyboard Shortcuts</strong>
            <p><kbd>R</kbd> Refresh &bull; <kbd>F</kbd> Filters &bull; <kbd>E</kbd> Expand all &bull; Double-click to open in DevOps</p>
          </div>
        </div>
      </div>
      
      <button id="walkthrough-done" class="btn-primary walkthrough-done-btn">Got it!</button>
    </div>
  </div>

  <!-- Feedback Footer -->
  <div id="feedback-footer" hidden>
    <a href="https://github.com/jsl1995/devops-timesheet/issues/new" target="_blank" rel="noopener">
      Have a problem or want to request a feature? Click here
    </a>
  </div>

  <script src="sidepanel.js"></script>
</body>
</html>
